<!DOCTYPE html>
<html lang="fr" layout:decorate="~{decorators/master}"
      xmlns:layout="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recherche de Vols</title>
    <link rel="stylesheet" type="text/css" th:href="@{css/style.css}">
</head>
    <body>
        <header>
        <h1>Recherche de Vols</h1>
        </header>

        <section>
            <!-- Contenu de la recherche de vols -->
            <h2>Bienvenue sur notre site de recherche de vols</h2>
            <p>Commencez votre aventure en trouvant les meilleurs vols disponibles.</p>
            <a href="/addView">
                <button>Ajouter un vol</button>
            </a>
            <!-- Ajoutez ici le formulaire de recherche de vols ou d'autres éléments pertinents -->
            <form th:action="@{/}" method="get" style="margin-bottom: 30px;">
                <label>Prix minimum</label>
                <input type="number" step="0.01" name="minPrice" th:value="${param.minPrice}">

                <label>Prix maximum</label>
                <input type="number" step="0.01" name="maxPrice" th:value="${param.maxPrice}">

                <label>Aéroport de départ</label>
                <input type="text" name="origin" th:value="${param.origin}" >

                <label>Aéroport d'arrivée</label>
                <input type="text" name="destination" th:value="${param.destination}">


                <label>Date de départ</label>
                <input type="date" name="departure" th:value="${param.departure}">

                <button type="submit">Filtrer</button>
            </form>
            <ul>
                <table>

                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Départ de</th>
                        <th scope="col">Arrivée à</th>
                        <th scope="col">Date de départ</th>
                        <th scope="col">Date d'arrivée</th>
                        <th scope="col">Prix</th>
                        <th scope="col">Photo</th>
                    </tr>
                    <tr th:each="flight : ${flights}"  class="clickable-row" th:attr="data-href=@{/details(id=${flight.id})}">

                        <th th:text="${flight.id}"></th>
                        <th th:text="${flight.origin.name}"></th>
                        <th th:text="${flight.destination.name}"></th>
                        <th th:text="${#temporals.format(flight.departure, 'dd/MM/yyyy HH:mm')}"></th>
                        <th th:text="${#temporals.format(flight.arrival, 'dd/MM/yyyy HH:mm')}"></th>
                        <td th:text="${T(java.lang.String).format('%.2f €', flight.price)}"></td>
                        <th ><img th:src="${flight.image}" alt="image" width="150" loading="lazy"></th>

                    </tr>
                </table>
                <div>
                    <form method="get" th:action="@{/}">
                        <input type="hidden" name="minPrice" th:value="${param.minPrice}">
                        <input type="hidden" name="maxPrice" th:value="${param.maxPrice}">
                        <input type="hidden" name="origin" th:value="${param.origin}">
                        <input type="hidden" name="destination" th:value="${param.destination}">
                        <input type="hidden" name="departure" th:value="${param.departure}">

                        <label for="pageSelect">Page :</label>

                        <select id="pageSelect" name="page" onchange="this.form.submit()">
                            <option th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                    th:value="${i}"
                                    th:text="${'Page ' + (i + 1)}"
                                    th:selected="${i == currentPage}">
                            </option>
                        </select>
                    </form>
                </div>

            </ul>
        </section>

        <footer>
            <p>&copy; 2023 Recherche de Vols. Tous droits réservés.</p>
        </footer>

        <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".clickable-row").forEach(row => {
                row.addEventListener("click", () => {
                    window.location = row.dataset.href;
                });
            });
        });
        </script>

    </body>
</html>